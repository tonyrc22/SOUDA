
@{
    ViewBag.Title = "NuevaMatricula";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<ol class="breadcrumb mb-4 mt-4">
    <li class="breadcrumb-item"><a href="index.html">Resumen</a></li>
    <li class="breadcrumb-item active ">  Nueva Matricula </li>
</ol>

<blockquote class="blockquote">
    <h2>Nueva Matricula</h2>
    <button type="button" class="btn btn-info" style='font-size:20px' onclick="ModalVideo(1)">Ayuda en LESCO  <i class='fas fa-american-sign-language-interpreting'></i></button>
</blockquote>


<br />
<br />
<br />
<br />


<div class="card">
    <div class="card-header">
        <i class="fas fa-user "> </i>  <h4> 1. Seleccione Sede de matricula </h4>

        <!-- Seleccionar SEDE------------------------------------------------------------ -->
        <!-- Large button groups (default and split) -->



        <select class="selectpicker" style="width: 200px">
            <option value="No Aplica">No Aplica</option>
            <option value="Heredia">Heredia</option>
            <option value="San Jose">San Jose</option>
            <option value="Alajuela">Alajuela</option>

        </select>
        <br />
        <br />
        <form>
            <label for="text" class="col-sm-2 col-form-label"> Sede Seleccionada:</label>
            <div class="col-sm-9">
                <input type="text" class="form-control" id="SedeSelec" placeholder="Seleccione Sede" value="No Aplica" disabled />
            </div>


        </form>




    </div>
</div>

<!-- Seleccionar SEDE------------------------------------------------------------ -->

<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />






@*Listar Estudiantes*@

<div class="card">
    <div class="card-header">
        <i class="fas fa-user "> </i>  <h3> 2. Seleccione Estudiante a Matricular </h3>


    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-12">
                @*<button type="button" class="btn btn-success" onclick="abrirModal(null)">Crear Nuevo</button>*@  @*Boton crear nuevo, coloque abrir modal = 0*@

            </div>
        </div>

        <hr />
        <table id="TablaEstudiante" class="display cell-boarder " style="width: auto ">

            <thead>
                <tr>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Cedula</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Nombre</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Apellido</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Telefono</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Correo</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Provincia</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Fecha de ingreso</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Fecha Nacimeinto</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Sexo</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Discapacidad</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Cedula Encarg</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1"></th>


                </tr>

            </thead>
            <tbody>
            </tbody>


        </table>

    </div>
</div>

<br />
<br />



@*Form de estuiantes*@
<form>
    <div class="form-group row">
        <label for="staticEmail" class="col-sm-2 col-form-label">Estudiante Seleccionado:</label> <br />
        <div class="col-sm-10">
            <input type="text" readonly=readonly class="form-control-plaintext" id="student" value="" readonly=readonly />
        </div>
    </div>
    <div class="form-group row">
        <label for="text" class="col-sm-2 col-form-label">Nombre del Estudiante</label>
        <div class="col-sm-9">
            <input type="text" class="form-control" id="EstudianteSeleccionado" placeholder="Seleccione Estudiante" disabled />
        </div>

        <label for="text" class="col-sm-2 col-form-label">Cedula del Estudiante</label>
        <div class="col-sm-9">
            <input type="number" class="form-control" id="EstudianteCedulaSeleccionado" placeholder="Seleccione Estudiante" disabled />
        </div>

        <label for="text" class="col-sm-2 col-form-label">Correo del Estudiante</label>
        <div class="col-sm-9">
            <input type="text" class="form-control" id="EstudianteCorreoSeleccionado" placeholder="Seleccione Estudiante" disabled />
        </div>

        <label for="text" class="col-sm-2 col-form-label">Discapacidad</label>
        <div class="col-sm-9">
            <input type="text" class="form-control" id="EstudianteDiscapacidadSeleccionado" placeholder="Seleccione Estudiante" disabled />
        </div>

        <label for="text" class="col-sm-2 col-form-label">Provincia</label>
        <div class="col-sm-9">
            <input type="text" class="form-control" id="EstudianteProvinciaSeleccionado" placeholder="Seleccione Estudiante" disabled />
        </div>

    </div>
</form>
<br />
<br />
<br />
<br />





































@*Lista Cursos //////////////////////////////////////////////////////////////////////////////*@





<div class="card">
    <div class="card-header">
        <i class="fas fa-user "> </i>  <h3>3. Seleccione Curso a matricular </h3>

    </div>



    <div class="card-body">
        <div class="row">
            <div class="col-12">
                @* <button type="button" class="btn btn-success" onclick="abrirModal(null)">Crear Nuevo</button>*@ @*Boton crear nuevo, coloque abrir modal = 0*@

            </div>
        </div>

        <hr />
        <table id="Tablanuevamatricula" class="display cell-boarder " style="width: auto ">

            <thead>
                <tr>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Codigo Curso</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Fecha Inicio</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Nombre del Curso</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1">Nombre del Profesor</th>
                    <th class="sorting" tabindex="0" aria-controls="TASK_LIST_GRID" rowspan="1" colspan="1"></th>



                </tr>

            </thead>
            <tbody>
            </tbody>


        </table>

    </div>
</div>



<form>
    <div class="form-group row">
        <label for="staticEmail" class="col-sm-2 col-form-label">Curso Seleccionado:</label>
        <div class="col-sm-10">
            <input type="text" readonly=readonly class="form-control-plaintext" id="Curso" value="" readonly=readonly />
        </div>
    </div>
    <div class="form-group row">
        <label for="text" class="col-sm-2 col-form-label">Nombre del Curso</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="CursoSeleccionado" placeholder="Seleccione curso" disabled />
        </div>

        <label for="text" class="col-sm-2 col-form-label">Fecha Inicio Curso</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="CursoFechaSeleccionado" placeholder="Seleccione curso" disabled />
        </div>

        <label for="text" class="col-sm-2 col-form-label">Codigo del Curso</label>
        <div class="col-sm-10">
            <input type="number" class="form-control" id="CursoCodigoSeleccionado" placeholder="Seleccione curso" disabled />
        </div>

        <label for="text" class="col-sm-2 col-form-label">Profesor</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="CursoProfeSeleccionado" placeholder="Seleccione curso" disabled />
        </div>

    </div>
</form>

<br />
<br />
<br />
<br />

<form>
    <div class="form-group">
        <label for="exampleFormControlInput1">Usuario Encargado</label><br />
        <br />
        <label for="exampleFormControlInput1">Usuario </label>
        <input type="text" class="form-control" id="UsuarioSeleccionado" disabled>
        <input type="text" class="form-control" id="UsuarioCEDSeleccionado" disabled>
    </div>
    @*<div class="form-group">

            <input type="number" class="form-control" id="CedulaUSUSeleccionado"  hidden>
        </div>

        <button type="button" class="btn btn-success btn-lg" onclick="BuscarUSU()">Confirmar Usuario </button>
    *@








</form>

<br/> <br /> <br />





<button type="button" class="btn btn-success btn-lg" onclick="ModalConfirma()">Confirmar Matricula </button>



@*MODAL DEL VIDEOS DE AYUDA*@
<!-- Modal -->
<div class="modal fade modal-lg" id="ModalVideo" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Video Ayuda En Lesco</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <input type="text" class="form-control" id="tipovideo" hidden>

            </div>

            <div class="row">

                <iframe width="560" height="315" src="https://www.youtube.com/embed/ug40buaIKGY?si=s3yU_GIu06VhEXXc&amp;controls=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>





            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>

            </div>
        </div>
    </div>
</div>

<br />
<br />
<br />
<br />
<br />








<!--<div class="card">
    <div class="card-header">
        <i class="fas fa-user "> </i>  <h4> 4. Ingrese sus Credenciales </h4>-->
<!-- Seleccionar SEDE------------------------------------------------------------ -->
<!-- Large button groups (default and split) -->
<!--<form>

            <label for="text" class="col-sm-2 col-form-label"> Ingrese Usuario:</label>
            <div class="col-sm-9">
                <input type="text" class="form-control" id="Usuarioplace" placeholder="Seleccione Sede" value="Usuario" disabled />
            </div>

            <label for="text" class="col-sm-2 col-form-label"> Ingrese Contrasena:</label>
            <div class="col-sm-9">
                <input type="text" class="form-control" id="contrasenaplace" placeholder="Seleccione Sede" value="xxxxxxxxxx" disabled />
            </div>

        </form>








    </div>
</div>-->
@*MODAL Confirmacion Matricula*@
<!-- Modal -->
<div class="modal fade modal-lg" id="ModalConfirmar" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog mx-auto">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mx-auto" id="staticBackdropLabel">Confirmacion Matricula</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <input type="text" class="form-control" id="tipovideo" hidden>

            </div>
            <br />

            <form>
                <fieldset disabled>


                    <div class="mb-3 ml-10">
                        <label for="disabledTextInput" class="form-label ">Sede</label>
                        <input type="text" id="SedeConfirma" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">Nombre del Estudiante</label>
                        <input type="text" id="NombreConfirma" class="form-control ">
                    </div>

                    <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">Cedula del Estudiante</label>
                        <input type="number" id="CedulaConfirma" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">Codigo de Curso</label>
                        <input type="number" id="CodCursoConfirma" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">Nombre del Curso</label>
                        <input type="text" id="NombreCursoConfirma" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">Nombre del Profesor</label>
                        <input type="text" id="ProfesorNombreConfirma" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">Fecha Inicio Curso</label>
                        <input type="text" id="FechaCursoConfirma" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="disabledTextInput" class="form-label">Usuario que Registra la matricula</label>
                        <br />
                        <input type="text" id="UsuarioConfirma" class="form-control">
                        <input type="number" id="CedulaUsuarioConfirma" class="form-control">
                    </div>


                </fieldset>
                <button type="button" class="btn btn-primary" onclick="RegistrarNuevaMatricula()">Matricular</button>
            </form>

            <div class="row mt-2">
                <div class="col-12">

                    <div id="mensajeError" class="alert alert-danger" role="alert">
                        A simple danger alert—check it out!
                    </div>
                </div>

            </div>







            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>

            </div>
        </div>
    </div>
</div>



























@section scripts{
    <script>

        var tabladata;
            var filaseleccionada;
            var Ced = (localStorage.Ced);
            var Nombre = (localStorage.Nombre);
            var apellido = (localStorage.Ape);

            $("#UsuarioConfirma").val(Nombre + " " + apellido)
            $("#CedulaUsuarioConfirma").val(Ced)
            $("#UsuarioCEDSeleccionado").val(Ced)
            $("#UsuarioSeleccionado").val(Nombre + " " + apellido)
            debugger;

            alert(Ced)

         $(document).ready(function () {
            $.ajax({
                url: '@Url.Action("Listarnuevamatricula","Home")',
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {

                    console.log(data)
                }
            })
         });



        tabladata = $("#Tablanuevamatricula").DataTable({

            Responsive: true,
            ordering: false,
            "ajax": {
                url: '@Url.Action("Listarnuevamatricula", "Home")',
                type: "GET",
                dataType: "json",
            },
            "columns": [
                { "data": "CU_CodCurso" },
                { "data": "CU_FechaInicio" },
                { "data": "CU_Nombre" },
                { "data": "PR_Nombre" },

                {
                    "defaultContent": '<button type="button" class="btn btn-primary btn-sm btn-seleccion"><i class="far fa-check-circle"></i>Seleccione Curso</button>', //+
                       // '<button type="button" class="btn btn-danger btn-sm ms-2 btn-eliminar"><i class="fas fa-trash"></i></button>',
                    "Orderable": false,
                    "Searchable": false,
                    "width":"90px"

                }
                @*Para hacer botonoes min 22 VID 07*@



            ],
            "language": { "url":"//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json" }



        });







        // Lista Estudiantes//////////////////////////////////////////////////////////////////////////

        var tabladataE;
        var filaseleccionadaE;




             $(document).ready(function () {
        $.ajax({
            url: '@Url.Action("Listarestudiante","Home")',
            type: "GET",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (dataE) {

                console.log(dataE)
            }
        })
    });

        tabladataE = $("#TablaEstudiante").DataTable({

            Responsive: true,
            ordering: false,
            "ajax": {
                url: '@Url.Action("Listarestudiante","Home")',
                type: "GET",
                dataType: "json",
            },
            "columns": [
                { "data": "ES_CedulaES" },
                { "data": "ES_Nombre" },
                { "data": "ES_Apellido" },
                { "data": "ES_Telefono" },
                { "data": "ES_Correo" },
                { "data": "ES_Provincia" },
                { "data": "ES_FechaIngreso" },
                { "data": "ES_FechaNacim" },
                { "data": "ES_SEXO" },
                { "data": "ES_Discap" },
                { "data": "ES_PadreCed" },
                {
                    "defaultContent": '<button type="button" class="btn btn-primary btn-sm btn-seleccionEstu"><i class="far fa-check-circle"></i>Seleccione Estudiante</button>' ,
                        //'<button type="button" class="btn btn-danger btn-sm ms-2 btn-eliminar"><i class="fas fa-trash"></i></button>',
                    "Orderable": false,
                    "Searchable": false,
                    "width":"90px"

                }
                @*Para hacer botonoes min 22 VID 07*@



            ],
            "language": { "url":"//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json" }



        });

        $("#TablaEstudiante tbody").on("click", '.btn-seleccionEstu', function () {



            filaseleccionadaE = $(this).closest("tr");

            var dataes = tabladataE.row(filaseleccionadaE).data()
            $("#EstudianteSeleccionado").val(dataes.ES_Apellido)
            $("#EstudianteSeleccionado").val(dataes.ES_Nombre + " " + dataes.ES_Apellido)
            $("#EstudianteCedulaSeleccionado").val(dataes.ES_CedulaES)
            $("#EstudianteCorreoSeleccionado").val(dataes.ES_Correo)
            $("#EstudianteDiscapacidadSeleccionado").val(dataes.ES_Discap)
            $("#EstudianteProvinciaSeleccionado").val(dataes.ES_Provincia)

            debugger;


            console.log(data)


            // abrirModal(data)



        })


    //////////////DropList///////////////
    $('.selectpicker').change(function () {
        var selectedItem = $('.selectpicker').val();
        $("#SedeSelec").val(selectedItem).tostring();
    });


















        function abrirModal(json) { @*Abre modal *@


            $("#Control").val(0); // Control para crear usuario nuevo

            $("#txtCedula").val("");
            $("#txtnombre").val("");
            $("#txtapellido").val("");
            $("#txtnumero").val("");
            $("#txtcorreo").val("");
            $("#txtprovincia").val("");
            $("#txtfechain").val("");
            $("#txtfechana").val("");
            $("#txtsexo").val("");
            $("#txtdiscapacidad").val("");
            $("#txtcedulaencarg").val("");
            $("#mensajeError").hide();



            if (json != null) {


                $("#Control").val(1) //Control para actualizar usuario
                $("#txtCedula").val(json.ES_CedulaES)
                $("#txtnombre").val(json.ES_Nombre)
                $("#txtapellido").val(json.ES_Apellido)
                $("#txtnumero").val(json.ES_Telefono)
                $("#txtcorreo").val(json.ES_Correo)
                $("#txtprovincia").val(json.ES_Provincia == (json.ES_Provincia) ? (json.ES_Provincia) : null)
                $("#txtfechain").val(json.ES_FechaIngreso)
                $("#txtfechana").val(json.ES_FechaNacim == (json.ES_FechaNacim) ? (json.ES_FechaNacim) : null)
                $("#txtsexo").val(json.ES_SEXO == (json.ES_SEXO) ? (json.ES_SEXO) : null)
                $("#txtdiscapacidad").val(json.ES_Discap == (json.ES_Discap) ? (json.ES_Discap) : null)
                $("#txtcedulaencarg").val(json.ES_PadreCed)



            }

            $("#FormModalES").modal("show");


        }

        $("#Tablanuevamatricula tbody").on("click", '.btn-seleccion', function () { // editar

           // alert("hola")

            filaseleccionada = $(this).closest("tr");  //trae los datos de la fila para el Update Video07 final
           var data= tabladata.row(filaseleccionada).data();
            // console.log(tabladata.row(filaseleccionada).data()); // ve la data en consola
            $("#CursoSeleccionado").val(data.CU_Nombre)
            $("#CursoFechaSeleccionado").val(data.CU_FechaInicio)
            $("#CursoProfeSeleccionado").val(data.PR_Nombre)
            $("#CursoCodigoSeleccionado").val(data.CU_CodCurso)
            //$("#CursoSeleccionado").val(data.CU_Nombre)



            console.log(data)


           // abrirModal(data)



        })


       



        function ModalVideo(opcion) {


            $("#ModalVideo").modal("show");

        }

            function ModalConfirma(opcion) {



            $("#SedeConfirma").val($("#SedeSelec").val())
            $("#NombreConfirma").val($("#EstudianteSeleccionado").val())
            $("#CedulaConfirma").val($("#EstudianteCedulaSeleccionado").val())
            $("#CodCursoConfirma").val($("#CursoCodigoSeleccionado").val())
            $("#NombreCursoConfirma").val($("#CursoSeleccionado").val())
            $("#FechaCursoConfirma").val($("#CursoFechaSeleccionado").val())
            $("#ProfesorNombreConfirma").val($("#CursoProfeSeleccionado").val())


                $("#UsuarioConfirma").val($("#UsuarioSeleccionado").val())
                $("#CedulaUsuarioConfirma").val($("#UsuarioCEDSeleccionado").val())




                $("#mensajeError").hide();
            $("#ModalConfirmar").modal("show");

            }



            function RegistrarNuevaMatricula() {

                alert("guardando");

                    var Matriculanueva = {


                            Control: $("#Control").val(),
                            MA_SEDE: $("#SedeConfirma").val(),
                            MA_CedulaES: $("#CedulaConfirma").val(),
                            MA_CodCurso: $("#CodCursoConfirma").val(),
                            MA_USCedula: $("#CedulaUsuarioConfirma").val(),
                            Control: 0,


                    }
                        debugger;
                       jQuery.ajax({ // video 11 min8
                           url: '@Url.Action("GuardarMatriculaNueva", "Home")',
                           type: "POST",
                           data: JSON.stringify({ objeto: Matriculanueva }),
                           dataType: "json",
                           contentType: "application/json; charset=utf-8",
                           success: function (data) {

                               debugger;
                               //$('.modal-body').LoadingOverlay("hide");


                               // USUARIO NUEVO
                               if (Matriculanueva.Control == 0) { // esta creando nuevo =0 y actualizando =1

                                    alert("Creando")
                                    if (data.resultado != 0) {
                                        debugger;
                                        Matriculanueva.Control = data.resultado;
                                       tabladata.row.add(Matriculanueva).draw(false);
                                        $("#ModalConfirmar").modal("hide");
                                        location.reload()




                                    } else if (data.mensaje == "No se puede convertir un objeto DBNull en otros tipos.") {
                                        Matriculanueva.Control = data.resultado;
                                        tabladata.row.add(Matriculanueva).draw(false);
                                        $("#ModalConfirmar").modal("hide");
                                        location.reload()

                                    } else {
                                        $("#mensajeError").text(data.mensaje);
                                        $("#mensajeError").show();
                                    }



                                    // USUARIO Actualizar/ editar
                                } else {
                                    alert("Actualizando")

                                    if (data.resultado) {

                                       // tabladata.row(filaseleccionada).data(Matriculanueva).draw(false);
                                        filaseleccionada = null;
                                        $("#ModalConfirmar").modal("hide");
                                    } else {
                                        $("#mensajeError").text(data.mensaje);
                                        $("#mensajeError").show();

                                    }
                                }

                            },
                           error: function (error) {
                               $('.modal-body').LoadingOverlay("hide");
                               console.log(data)
                               $("#mensajeError").text("Error ajax");
                               $("#mensajeError").show();
                           },


                           beforeSend: function () {
                               $('.modal-body').LoadingOverlay("show", { imageResizeFactor: 2, text:"Cargando...",size:14 })

                           }

                        });

                    }









    </script>
}

